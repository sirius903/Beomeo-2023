<!DOCTYPE html>
<html lang="ko">
<head>
 	<meta charset="UTF-8">
 	<meta http-equiv="X-UA-Compatible" content="IE=edge">
 	<meta name="viewport" content="width=device-width, initial-scale=1.0">
 	<title>Document</title>
	<link href="style.css" rel="stylesheet">
</head>
<body>
	<div id="chat-window"></div>
	<div id="message-input" align="center">
		<input type="text" id="message" placeholder="메시지를 입력하세요.">
		<button onclick="sendMessage()">보내기</button>
		<button onclick="closeWindow()">창닫기</button>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
	<script>
		function closeWindow(){
			socket.disconnect();
			if(/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent)){
				window.history.back();
			}else{
				window.close();
			}
		}
		
		const socket = io.connect();
		let userId = prompt('환영합니다. \n \n 아이디를 입력하세요.');
		socket.emit('set user', userId);
		document.getElementById('message').focus();
		
		function sendMessage(){
			const messageInput = document.getElementById("message");
			const message = messageInput.value;
			if(message){
				socket.emit('chat message', {
					id:userId,
					message: message
				});
				messageInput.value = '';
			}
		}
		
		document.getElementById('message').addEventLisstener('keydown', function(e){
			if(e.key === 'Enter' && !event.shiftKey) {
				event.preventDefault();
				sendMessage();
			}
		});
		socket.on('chat message', (data) => {
			const chatWindow = document.getElementById("chat-window");
			const messageDiv = document.createElement('div');
			messageDiv.className = data.id === userId ? 'my-message' : 'other-message';
			
			const idDiv = document.createElement('div');
			
		})
	</script>
</body>
</html>
